<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Mastermind</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <script src="./index.js"></script>
    <script>
      const colorCombinations = new Array(Math.pow(colors.length, 4)).fill().map((_x, i) => [
        colors[Math.floor(i / colors.length / colors.length / colors.length) % colors.length],
        colors[Math.floor(i / colors.length / colors.length) % colors.length],
        colors[Math.floor(i / colors.length) % colors.length],
        colors[i % colors.length],
      ]);

      function possibleColors(game) {
        return colorCombinations.filter((combination) => {
          if (!game.repeats && !combination.every(firstOccurance)) return false;

          return game.turns.every((turn) => {
            const { matches, misses } = MastermindGame.overlap(combination, turn.guess);
            return matches === turn.matches && misses === turn.misses;
          });
        });
      }
      function gameWon(game) {
        const { turns } = game
        const lastTurn = turns.slice(-1)[0];
        return lastTurn && lastTurn.matches === 4;
      }
      function takeTurn(game) {
        if (!gameWon(game)) game.guess(possibleColors(game)[0]);
        return game;
      }
      function finishGame(game) {
        while (!gameWon(game)) takeTurn(game);
        return game;
      }

      const colorMap = { red: '🔴', green: '💚', blue: '🔵', yellow: '💛', black: '⚫️', white: '⚪️' };
      function printGame(game) {
        console.group(`MastermindGame key: ${game.key.map(k => colorMap[k]).join('')} ${game.repeats ? 'duplicate colors' : 'no duplicate colors'}`);
        game.turns.forEach(({ matches, misses, guess }) => {
          console.log(
            new Array(matches).fill('◼️').concat(new Array(misses).fill('◻️')).concat(new Array(4-matches-misses).fill('  ')).join(''),
            guess.map(g => colorMap[g]).join('')
          );
        });
        console.groupEnd();
      }

      let game = new MastermindGame(colors, true);
      finishGame(game);
      printGame(game);
    </script>
  </body>
</html>
